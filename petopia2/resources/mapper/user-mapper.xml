<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="userMapper">

	<!-- ================== resultMap ================== -->
	<!-- =============================================== -->
	<resultMap type="user" id="userResultSet">
		<result column="USER_NO" property="userNo"/>
		<result column="USER_METHOD" property="userMethod"/>
		<result column="USER_EMAIL" property="userEmail"/>
		<result column="USER_PASS" property="userPass"/>
		<result column="USER_NICKNAME" property="userNickname"/>
		<result column="USER_PHONE" property="userPhone"/>
		<result column="ROLE_NAME" property="roleId"/>
		<result column="USER_CREATE_DATE" property="userCreateDate"/>
		<result column="USER_UPDATE_DATE" property="userUpdateDate"/>
		<result column="USER_ENABLE_STATE" property="userEnableState"/>
		<result column="FILE_MYPAGE_NO" property="fileMypageNo"/>
	</resultMap>
	
	
	<!-- ===================== SQL ===================== -->
	<!-- =============================================== -->
	<insert id="insertUser" parameterType="petopia.com.kh.jsp.user.model.vo.User">
  		 INSERT 
		   INTO TB_USER
		  		(
			    USER_NO,
				USER_METHOD,
				USER_EMAIL,
				USER_PASS,
				USER_NICKNAME,
				USER_PHONE
				) 
		VALUES  
				(
				SEQ_USER_NO.NEXTVAL,
				#{userMethod},
				#{userEmail},
				#{userPass},
				#{userNickname},
				#{userPhone}
				)
	</insert>
	 
	
	
	<select id="loginUser" parameterType="user" resultMap="userResultSet">
		SELECT
				USER_NO,
				USER_METHOD,
				USER_EMAIL,
				USER_PASS,
				USER_NICKNAME,
				USER_PHONE,
				ROLE_NAME,
				USER_CREATE_DATE,
				USER_UPDATE_DATE,
				USER_ENABLE_STATE,
				FILE_PATH||'/'||UPLOAD_NAME "PATH"
		   FROM
				TB_USER
		   JOIN TB_ROLE USING(ROLE_ID)
		   LEFT JOIN TB_MYPAGE_FILE USING(FILE_MYPAGE_NO)
		  WHERE
				USER_EMAIL = #{userEmail}
			AND
				USER_PASS = #{userPass}
			AND
				USER_METHOD = 0
			AND
				USER_ENABLE_STATE = 'Y'
	</select>
  
</mapper>